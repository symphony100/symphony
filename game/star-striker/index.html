<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Star Striker</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body, html {
    height: 100%; background: radial-gradient(ellipse at center, #001022 0%, #000000 100%);
    overflow: hidden; font-family: 'Orbitron', sans-serif; color: #00ffd8;
    user-select: none;
    touch-action: none;
  }
  canvas { display: block; margin: 0 auto; background: transparent; }

  /* スプラッシュ画面 */
  #splash {
    position: fixed; top:0; left:0; width: 100%; height: 100%;
    background: #000c1a;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 10;
    animation: fadein 1s ease forwards;
  }
  #splash h1 {
    font-size: 4rem; color: #00ffe3; text-shadow: 0 0 15px #00ffe3, 0 0 30px #00ffd8;
    margin-bottom: 20px; text-align: center;
  }
  #startBtn {
    font-size: 1.8rem;
    color: #000; background: #00ffd8;
    border: none; padding: 15px 40px;
    border-radius: 50px; cursor: pointer;
    box-shadow: 0 0 15px #00ffd8;
    transition: background 0.3s ease;
  }
  #startBtn:hover { background: #00bfa5; }

  /* HUD */
  #hud {
    position: fixed; top: 10px; left: 10px; width: calc(100% - 20px);
    display: flex; justify-content: space-between; font-size: 20px;
    text-shadow: 0 0 5px #00ffd8;
  }
  #score, #level {
    background: rgba(0, 255, 216, 0.1);
    padding: 6px 12px; border-radius: 10px;
    min-width: 120px; text-align: center;
  }

  /* ゲームオーバー画面 */
  #gameover {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.85);
    padding: 40px 60px; border-radius: 20px;
    box-shadow: 0 0 50px #00ffd8; color: #00ffe3;
    font-size: 3rem; display: none; text-align: center; z-index: 20;
  }
  #gameover p { margin-bottom: 30px; }
  #restartBtn {
    font-size: 1.8rem; color: #000; background: #00ffd8;
    border: none; padding: 12px 30px; border-radius: 40px;
    cursor: pointer; box-shadow: 0 0 15px #00ffd8;
    transition: background 0.3s ease;
  }
  #restartBtn:hover { background: #00bfa5; }

  /* タッチ操作用UI */
  #touchControls {
    position: fixed; bottom: 0; left: 0;
    width: 100%; height: 40%;
    display: flex; z-index: 5;
  }
  .touchArea {
    flex: 1; background: rgba(0,0,0,0); /* 半透明背景にしたければ0.1など */
  }

  @keyframes fadein { 0% {opacity: 0;} 100% {opacity: 1;} }
</style>
</head>
<body>

<!-- BGM & 効果音 -->
<audio id="bgm" loop>
  <source src="bgm.mp3" type="audio/mpeg">
</audio>
<audio id="starSE">
  <source src="star.mp3" type="audio/mpeg">
</audio>
<audio id="hitSE">
  <source src="hit.mp3" type="audio/mpeg">
</audio>

<div id="splash">
  <h1>Star Striker</h1>
  <button id="startBtn">スタート</button>
</div>

<div id="hud" style="display:none;">
  <div id="score">スコア: 0</div>
  <div id="level">レベル: 1</div>
</div>

<div id="gameover">
  <p>ゲームオーバー</p>
  <p id="finalScore"></p>
  <button id="restartBtn">リスタート</button>
</div>

<!-- タッチ操作エリア -->
<div id="touchControls" style="display:none;">
  <div id="leftArea" class="touchArea"></div>
  <div id="rightArea" class="touchArea"></div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const splash = document.getElementById('splash');
  const startBtn = document.getElementById('startBtn');
  const hud = document.getElementById('hud');
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const gameoverEl = document.getElementById('gameover');
  const finalScoreEl = document.getElementById('finalScore');
  const restartBtn = document.getElementById('restartBtn');
  const touchControls = document.getElementById('touchControls');
  const leftArea = document.getElementById('leftArea');
  const rightArea = document.getElementById('rightArea');

  const bgm = document.getElementById('bgm');
  const starSE = document.getElementById('starSE');
  const hitSE = document.getElementById('hitSE');

  let WIDTH, HEIGHT;
  function resizeCanvas() {
    WIDTH = window.innerWidth;
    HEIGHT = window.innerHeight;
    canvas.width = WIDTH;
    canvas.height = HEIGHT;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  let score = 0;
  let level = 1;
  let gameOver = false;

  // 背景星
  const bgStars = [];
  for(let i=0; i<150; i++) {
    bgStars.push({
      x: Math.random() * WIDTH,
      y: Math.random() * HEIGHT,
      radius: Math.random() * 1.2,
      alpha: Math.random(),
      alphaSpeed: 0.005 + Math.random() * 0.015
    });
  }

  // プレイヤー
  const player = {
    x: WIDTH / 2,
    y: HEIGHT - 100,
    speed: 7,
    movingLeft: false,
    movingRight: false,
    draw() {
      ctx.fillStyle = '#00ffd8';
      ctx.shadowColor = '#00ffd8';
      ctx.shadowBlur = 15;
      ctx.beginPath();
      ctx.moveTo(this.x, this.y - 35);
      ctx.lineTo(this.x - 20, this.y + 35);
      ctx.lineTo(this.x + 20, this.y + 35);
      ctx.closePath();
      ctx.fill();

      ctx.shadowBlur = 10;
      ctx.fillStyle = '#00ffff';
      ctx.beginPath();
      ctx.arc(this.x, this.y - 50, 20, 0, Math.PI * 2);
      ctx.fill();

      ctx.shadowBlur = 0;
      const grad = ctx.createRadialGradient(this.x - 7, this.y - 55, 5, this.x - 10, this.y - 60, 15);
      grad.addColorStop(0, 'rgba(255,255,255,0.8)');
      grad.addColorStop(1, 'rgba(255,255,255,0)');
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(this.x - 10, this.y - 55, 15, 0, Math.PI * 2);
      ctx.fill();
    },
    update() {
      if (this.movingLeft) this.x -= this.speed;
      if (this.movingRight) this.x += this.speed;
      if (this.x < 25) this.x = 25;
      if (this.x > WIDTH - 25) this.x = WIDTH - 25;
    }
  };

  class Meteor {
    constructor(level) {
      this.x = Math.random() * (WIDTH - 40) + 20;
      this.y = -50;
      this.radius = 18 + Math.random() * 12;
      this.speed = 3 + level * 0.8 + Math.random() * 2;
      this.color = '#ff4500';
      this.angle = 0;
      this.rotationSpeed = 0.05 + Math.random() * 0.05;
    }
    draw() {
      ctx.save();
      ctx.translate(this.x, this.y);
      ctx.rotate(this.angle);
      ctx.fillStyle = this.color;
      ctx.shadowColor = '#ff4500';
      ctx.shadowBlur = 20;
      ctx.beginPath();
      for(let i=0; i<5; i++) {
        ctx.lineTo(
          this.radius * Math.cos(i * 2 * Math.PI / 5),
          this.radius * Math.sin(i * 2 * Math.PI / 5)
        );
        ctx.lineTo(
          this.radius/2 * Math.cos((i + 0.5) * 2 * Math.PI / 5),
          this.radius/2 * Math.sin((i + 0.5) * 2 * Math.PI / 5)
        );
      }
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }
    update() {
      this.y += this.speed;
      this.angle += this.rotationSpeed;
    }
  }

  class Star {
    constructor(level) {
      this.x = Math.random() * (WIDTH - 20) + 10;
      this.y = -20;
      this.radius = 10;
      this.speed = 2 + level * 0.6 + Math.random() * 1.5;
      this.color = '#00ffd8';
      this.blink = 0;
    }
    draw() {
      ctx.fillStyle = this.color;
      ctx.shadowColor = '#00ffd8';
      ctx.shadowBlur = 15;
      ctx.beginPath();
      for(let i=0; i<5; i++) {
        const angle = i * 2 * Math.PI / 5 - Math.PI / 2;
        const xOuter = this.x + this.radius * Math.cos(angle);
        const yOuter = this.y + this.radius * Math.sin(angle);
        const xInner = this.x + this.radius/2 * Math.cos(angle + Math.PI / 5);
        const yInner = this.y + this.radius/2 * Math.sin(angle + Math.PI / 5);
        if(i === 0) ctx.moveTo(xOuter, yOuter);
        else ctx.lineTo(xOuter, yOuter);
        ctx.lineTo(xInner, yInner);
      }
      ctx.closePath();
      ctx.globalAlpha = 0.5 + 0.5 * Math.sin(this.blink);
      ctx.fill();
      ctx.globalAlpha = 1;
    }
    update() {
      this.y += this.speed;
      this.blink += 0.15;
    }
  }

  const meteors = [];
  const stars = [];

  function isCollide(x1, y1, r1, x2, y2, r2) {
    const dx = x1 - x2;
    const dy = y1 - y2;
    return Math.sqrt(dx * dx + dy * dy) < r1 + r2;
  }

  function spawnObjects() {
    if (gameOver) return;
    if (Math.random() < 0.03 + score * 0.0007) stars.push(new Star(level));
    if (Math.random() < 0.02 + score * 0.0004) meteors.push(new Meteor(level));
  }

  function update() {
    if (gameOver) return;
    player.update();

    for (let i = meteors.length - 1; i >= 0; i--) {
      meteors[i].update();
      if (meteors[i].y > HEIGHT + 50) meteors.splice(i, 1);
      else if (isCollide(player.x, player.y - 10, 25, meteors[i].x, meteors[i].y, meteors[i].radius)) {
        gameOver = true;
        hitSE.currentTime = 0; hitSE.play();
        showGameOver();
      }
    }

    for (let i = stars.length - 1; i >= 0; i--) {
      stars[i].update();
      if (stars[i].y > HEIGHT + 50) stars.splice(i, 1);
      else if (isCollide(player.x, player.y - 10, 25, stars[i].x, stars[i].y, stars[i].radius)) {
        score++;
        scoreEl.textContent = `スコア: ${score}`;
        starSE.currentTime = 0; starSE.play();
        stars.splice(i, 1);
        if (score % 10 === 0) {
          level++;
          levelEl.textContent = `レベル: ${level}`;
        }
      }
    }
    spawnObjects();
  }

  function drawBackground() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);
    bgStars.forEach(star => {
      star.alpha += star.alphaSpeed;
      if (star.alpha > 1) star.alpha = 1;
      if (star.alpha < 0) star.alpha = 0;
      ctx.fillStyle = `rgba(0,255,216,${star.alpha.toFixed(2)})`;
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
      ctx.fill();
    });
  }

  function draw() {
    drawBackground();
    player.draw();
    meteors.forEach(m => m.draw());
    stars.forEach(s => s.draw());
  }

  function gameLoop() {
    update();
    draw();
    if (!gameOver) requestAnimationFrame(gameLoop);
  }

  function showGameOver() {
    finalScoreEl.textContent = `最終スコア: ${score}`;
    gameoverEl.style.display = 'block';
    touchControls.style.display = 'none';
  }

  function restartGame() {
    score = 0;
    level = 1;
    gameOver = false;
    meteors.length = 0;
    stars.length = 0;
    scoreEl.textContent = `スコア: ${score}`;
    levelEl.textContent = `レベル: ${level}`;
    gameoverEl.style.display = 'none';
    player.x = WIDTH / 2;
    player.y = HEIGHT - 100;
    touchControls.style.display = 'flex';
    gameLoop();
  }

  // PC操作
  window.addEventListener('keydown', e => {
    if (e.code === 'ArrowLeft' || e.code === 'KeyA') player.movingLeft = true;
    if (e.code === 'ArrowRight' || e.code === 'KeyD') player.movingRight = true;
  });
  window.addEventListener('keyup', e => {
    if (e.code === 'ArrowLeft' || e.code === 'KeyA') player.movingLeft = false;
    if (e.code === 'ArrowRight' || e.code === 'KeyD') player.movingRight = false;
  });

  // スマホタッチ操作
  leftArea.addEventListener('touchstart', () => { player.movingLeft = true; });
  leftArea.addEventListener('touchend', () => { player.movingLeft = false; });
  rightArea.addEventListener('touchstart', () => { player.movingRight = true; });
  rightArea.addEventListener('touchend', () => { player.movingRight = false; });

  startBtn.addEventListener('click', () => {
    splash.style.display = 'none';
    hud.style.display = 'flex';
    bgm.volume = 0.5;
    bgm.play();
    restartGame();
  });

  restartBtn.addEventListener('click', () => {
    gameoverEl.style.display = 'none';
    restartGame();
  });
})();
</script>

</body>
</html>
